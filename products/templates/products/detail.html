{% extends 'base.html' %}

{% block content %}
{% block styles %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/detail.css' %}">
{% endblock %}
<style> 

</style>
<script>
    
</script>
<div class="supercontain" >
<div class="contain">
    <div class="name">
        <a href="{{product.url}}"><h1>{{ product.title }}</h1></a>
        <img src="{{ product.icon.url }}" alt="Product Icon">
    </div>
    <div class="image"><img src="{{ product.image.url }}" alt="Product Image"></div>
    
    <div class="body">
        <div onmousedown='return false'class="circle"><div class="updiv"><svg class="svgvote" version="1.1" onclick="clickUp()"id="up" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
            width="97.285px" height="97.285px" viewBox="0 0 97.285 97.285" style="enable-background:new 0 0 97.285 97.285;" xml:space="preserve">
       <g>
           <path d="M83.952,34.479L50.056,0.585c-0.781-0.781-2.047-0.781-2.828,0L13.333,34.479c-0.781,0.781-0.781,2.047,0,2.828l9.03,9.031
               c0.375,0.375,0.883,0.586,1.414,0.586c0.53,0,1.039-0.211,1.414-0.586l14.534-14.532v63.478c0,1.104,0.896,2,2,2H55.56
               c1.104,0,2-0.896,2-2V31.807l14.532,14.532c0.75,0.75,2.078,0.75,2.828,0l9.031-9.031c0.375-0.375,0.586-0.884,0.586-1.414
               C84.538,35.364,84.327,34.854,83.952,34.479z"/>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       <g>
       </g>
       </svg>
    </div>
      
        <p onclick='return false' onmousedown='return false' id='total'>{{product.votes_total}}</p>
        
        <?xml version="1.0" encoding="iso-8859-1"?>
            <!-- Generator: Adobe Illustrator 19.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
            <svg onclick="clickDown()"class="svgvote" version="1.1" id="down" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                 viewBox="0 0 512 512" style="enable-background:new 0 0 512 512;" xml:space="preserve">
            <g>
                <g>
                    <path d="M441.156,322.876l-48.666-47.386c-3.319-3.243-8.619-3.234-11.93,0.017l-81.894,80.299V8.533
                        c0-4.71-3.823-8.533-8.533-8.533h-68.267c-4.71,0-8.533,3.823-8.533,8.533v347.273l-81.894-80.299
                        c-3.311-3.243-8.602-3.251-11.921-0.017l-48.666,47.386c-1.655,1.604-2.586,3.806-2.586,6.11c0,2.304,0.939,4.506,2.586,6.11
                        l179.2,174.481c1.655,1.613,3.806,2.423,5.948,2.423c2.15,0,4.292-0.811,5.956-2.423l179.2-174.481
                        c1.647-1.604,2.577-3.806,2.577-6.11C443.733,326.682,442.803,324.48,441.156,322.876z"/>
                </g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            <g>
            </g>
            </svg>
            
        </div>
            <div class="minbody"><div class="hunted"><h2> Hunted by {{product.hunter}}</h2></div>
            <div class="dates"><h2 id='dater' >{{product.pub_date}}</h2></div>
        <div class="textbody"><p>{{product.body}}</p></div>
    </div>
    </div>
</div>
</div>
<form name='upvote' id='upvote' method="POST" onsubmit='return post()' action="{% url 'upvote' product.id%}">
    <p id='csrf_token'>{% csrf_token %}</p>
    <input type="hidden" id='clickv' name='clickv' value=''>
</form>

<form id='downvoter' method="POST" action="{% url 'downvote' product.id%}">
    {% csrf_token %}
    <input type="hidden">
</form>
        
<script>
    let up = document.getElementById('up')
    
    function getCookie(c_name)
{
    if (document.cookie.length > 0)
    {
        c_start = document.cookie.indexOf(c_name + "=");
        if (c_start != -1)
        {
            c_start = c_start + c_name.length + 1;
            c_end = document.cookie.indexOf(";", c_start);
            if (c_end == -1) c_end = document.cookie.length;
            return unescape(document.cookie.substring(c_start,c_end));
        }
    }
    return "";
 }  let totaler = 0 
    let form = document.getElementById('upvote')
    let action = form.getAttribute('action')
    let click = document.getElementById('total').textContent
    totalclicks = 0 
    let divcircle = document.getElementsByClassName('circle')[0]
    
    function clickUp() {
        if (totalclicks == 1) return 
        click++
        totalclicks++
        totaler += 1
        let total = document.getElementById('total')
        total.innerHTML = click
        

    }

    /*$('#upvote').on('submit', (function(event) {
            event.preventDefault();

            $.ajax({
                type:'POST',
                url:'/<int:product_id>/', 
                data: {
                    clicks:$('clickv').val(), 
                    csrfmiddlewaretoken:$('p#csrf_token').val()
                }, 
                success:function() {
                    console.log('Successful')
                }
            })

    }));*/
 
    function post() {
        this.preventDefault()
        console.log('NOPE')
        $.ajax({
                type:'POST',
                url:'/products/4/upvote', 
                data: {
                    clicks:$('clickv').val(), 
                    csrfmiddlewaretoken:$('p#csrf_token').val()
                }, 
                success:function() {
                    console.log('Successful')
                }
            })

    }

    function clickDown() {
        if (totalclicks == -1) return 
        totalclicks -= 1
        click -= 1
        totaler += 1
        let total = document.getElementById('total')
        total.innerHTML = click

    }

    function setValueInput(input_id) {
        document.getElementById(input_id).setAttribute('value', click)
    }
    
    let total = document.getElementById('total').textContent
        
    var csrftoken = $("[name=csrfmiddlewaretoken]").val();
    
    setInterval(() => {setValueInput('clickv')}, 100)

   $('#up').on('click', function() {
    
        $.ajax(
           {
               type:'POST', 
               url: action, 
               headers: { "X-CSRFToken": getCookie("csrftoken") },
               data: {
                   click_count:click, 
               }, 
               success: function(response) {
                   console.log('It worked.')
               }
           }
       )
function slowUp() {
      $.ajax(
           {
               type:'GET',
               url: action,
               data: {
                  'vote_count': total 
               }, 
               async:true,
               timeout: 2000,
               success: function(data) {
                
                   document.getElementById('total').textContent = data['vote']
               }, error: function(xhr, textStatus) {
                   alert('error')
               }
           }
       )}
       setTimeout(slowUp, 100)

       
     })

    $('#down').on('click', function() {
        $.ajax(
           {
               type:'POST', 
               url: action, 
               headers: { "X-CSRFToken": getCookie("csrftoken") },
               data: {
                   click_count:click, 
                   
               }, 
               success: function(response) {
                   console.log('It worked.')
               }
           }
       )
    function slowDown() {
        $.ajax(
           {
               type:'GET',
               url: action,
               data: {
                  'vote_count': total 
               }, 
               timeout: 2000,
               async: true, 
               success: function(data) {
                
                   document.getElementById('total').textContent = data['vote']
               }, error: function(xhr, textStatus) {
                   alert('error')
               }
           }
       )
    } 
    setTimeout(slowDown, 100)
    })
   
   
    
</script>
{% endblock %}